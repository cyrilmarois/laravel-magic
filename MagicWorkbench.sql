-- MySQL Script generated by MySQL Workbench
-- Mon May  8 20:56:41 2017
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema Magic
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema Magic
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `MagicWorkbench` DEFAULT CHARACTER SET utf8 ;
USE `MagicWorkbench` ;

-- -----------------------------------------------------
-- Table `MagicWorkbench`.`type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`type` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  `slug` VARCHAR(30) NOT NULL,
  `parent_id` INT UNSIGNED NULL,
  PRIMARY KEY (`id`),
  INDEX `type_parent_id_foreign_idx` (`parent_id` ASC),
  CONSTRAINT `type_parent_id_foreign`
    FOREIGN KEY (`parent_id`)
    REFERENCES `MagicWorkbench`.`type` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`color`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`color` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`rarity`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`rarity` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `slug` VARCHAR(1) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`collection`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`collection` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  `slug` VARCHAR(45) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`set`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`set` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `slug` VARCHAR(45) NOT NULL,
  `logo_filename` VARCHAR(45) NOT NULL,
  `icon_filename` VARCHAR(45) NOT NULL,
  `quantity` INT UNSIGNED NOT NULL DEFAULT 0,
  `published_at` DATETIME NOT NULL,
  `collection_id` INT UNSIGNED NULL,
  PRIMARY KEY (`id`),
  INDEX `set_collection_id_foreign_idx` (`collection_id` ASC),
  CONSTRAINT `set_collection_id_foreign`
    FOREIGN KEY (`collection_id`)
    REFERENCES `MagicWorkbench`.`collection` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`card`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`card` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `mana_cost` VARCHAR(10) NOT NULL,
  `power` VARCHAR(2) NULL,
  `toughness` VARCHAR(2) NULL,
  `set_id` INT UNSIGNED NULL,
  `color_id` INT UNSIGNED NULL,
  `type_id` INT UNSIGNED NULL,
  `rarity_id` INT UNSIGNED NULL,
  PRIMARY KEY (`id`),
  INDEX `card_card_type_id_idx` (`type_id` ASC),
  INDEX `card_color_id_idx` (`color_id` ASC),
  INDEX `card_rarity_id_idx` (`rarity_id` ASC),
  INDEX `card_set_id_foreign_idx` (`set_id` ASC),
  CONSTRAINT `card_type_id_foreign`
    FOREIGN KEY (`type_id`)
    REFERENCES `MagicWorkbench`.`type` (`id`)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  CONSTRAINT `card_color_id_foreign`
    FOREIGN KEY (`color_id`)
    REFERENCES `MagicWorkbench`.`color` (`id`)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  CONSTRAINT `card_rarity_id_foreign`
    FOREIGN KEY (`rarity_id`)
    REFERENCES `MagicWorkbench`.`rarity` (`id`)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  CONSTRAINT `card_set_id_foreign`
    FOREIGN KEY (`set_id`)
    REFERENCES `MagicWorkbench`.`set` (`id`)
    ON DELETE SET NULL
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`deck`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`deck` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(50) NOT NULL,
  `color_id` INT UNSIGNED NULL,
  PRIMARY KEY (`id`),
  INDEX `deck_color_color_id_idx` (`color_id` ASC),
  CONSTRAINT `deck_color_id_foreign`
    FOREIGN KEY (`color_id`)
    REFERENCES `MagicWorkbench`.`color` (`id`)
    ON DELETE SET NULL
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`card_deck`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`card_deck` (
  `deck_id` INT UNSIGNED NOT NULL,
  `card_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`deck_id`, `card_id`),
  INDEX `deck_card_card_id_idx` (`card_id` ASC),
  CONSTRAINT `deck_card_deck_id_foreign`
    FOREIGN KEY (`deck_id`)
    REFERENCES `MagicWorkbench`.`deck` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `deck_card_card_id_foreign`
    FOREIGN KEY (`card_id`)
    REFERENCES `MagicWorkbench`.`card` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`language`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`language` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `slug` VARCHAR(2) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`card_content`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`card_content` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `filename` VARCHAR(45) NOT NULL,
  `content` TEXT NOT NULL,
  `card_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `card_content_card_id_idx` (`card_id` ASC),
  CONSTRAINT `card_content_card_id_foreign`
    FOREIGN KEY (`card_id`)
    REFERENCES `MagicWorkbench`.`card` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`user` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `first_name` VARCHAR(45) NULL,
  `last_name` VARCHAR(45) NULL,
  `user_name` VARCHAR(45) NULL,
  `password` VARCHAR(45) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`user_deck`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`user_deck` (
  `user_id` INT UNSIGNED NOT NULL,
  `deck_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`user_id`, `deck_id`),
  INDEX `user_deck_deck_id_idx` (`deck_id` ASC),
  CONSTRAINT `user_deck_user_id_foreign`
    FOREIGN KEY (`user_id`)
    REFERENCES `MagicWorkbench`.`user` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `user_deck_deck_id_foreign`
    FOREIGN KEY (`deck_id`)
    REFERENCES `MagicWorkbench`.`deck` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`set_rarity`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`set_rarity` (
  `set_id` INT UNSIGNED NOT NULL,
  `rarity_id` INT UNSIGNED NOT NULL,
  `icon_filename` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`set_id`, `rarity_id`),
  INDEX `set_rarity_rarity_id_idx` (`rarity_id` ASC),
  CONSTRAINT `set_rarity_set_id_foreign`
    FOREIGN KEY (`set_id`)
    REFERENCES `MagicWorkbench`.`set` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `set_rarity_rarity_id`
    FOREIGN KEY (`rarity_id`)
    REFERENCES `MagicWorkbench`.`rarity` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`format`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`format` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`card_format`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`card_format` (
  `card_id` INT UNSIGNED NOT NULL,
  `format_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`card_id`, `format_id`),
  INDEX `card_format_format_id_foreign_idx` (`format_id` ASC),
  CONSTRAINT `card_format_card_id_foreign`
    FOREIGN KEY (`card_id`)
    REFERENCES `MagicWorkbench`.`card` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `card_format_format_id_foreign`
    FOREIGN KEY (`format_id`)
    REFERENCES `MagicWorkbench`.`format` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`deck_format`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`deck_format` (
  `deck_id` INT UNSIGNED NOT NULL,
  `format_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`deck_id`, `format_id`),
  INDEX `deck_format_format_id_foreign_idx` (`format_id` ASC),
  CONSTRAINT `deck_format_deck_id_foreign`
    FOREIGN KEY (`deck_id`)
    REFERENCES `MagicWorkbench`.`deck` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `deck_format_format_id_foreign`
    FOREIGN KEY (`format_id`)
    REFERENCES `MagicWorkbench`.`format` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`set_content`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`set_content` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `set_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `set_content_set_id_foreign_idx` (`set_id` ASC),
  CONSTRAINT `set_content_set_id_foreign`
    FOREIGN KEY (`set_id`)
    REFERENCES `MagicWorkbench`.`set` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `MagicWorkbench`.`content`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `MagicWorkbench`.`content` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `element_id` INT UNSIGNED NOT NULL,
  `element_type` VARCHAR(45) NOT NULL,
  `language_id` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `content_element_id_idx` (`element_id` ASC),
  INDEX `content_language_id_idx` (`language_id` ASC),
  CONSTRAINT `content_element_id`
    FOREIGN KEY ()
    REFERENCES `MagicWorkbench`.`set_content` ()
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `content_element_id`
    FOREIGN KEY (`element_id`)
    REFERENCES `MagicWorkbench`.`card_content` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `content_language_id`
    FOREIGN KEY (`language_id`)
    REFERENCES `MagicWorkbench`.`language` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
